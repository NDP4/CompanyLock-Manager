@startuml Sequence_Fase6_MonitoringKeamanan
!theme plain

title Fase 6: Monitoring & Keamanan Sistem\nCompanyLock Manager System

actor "Admin IT" as Admin
actor "Karyawan" as Employee  
participant "Admin Dashboard" as Dashboard
participant "Backend API" as Backend
participant "Security Monitor" as Security
participant "Database" as DB
participant "Alert System" as Alerts
participant "Audit Logger" as AuditLog

== Sub-Fase 6A: Real-time Monitoring ==

Security -> Security : **1. Continuous monitoring aktif**
note right of Security
  **Sistem Monitoring 24/7:**
  
  ğŸ”„ **Auto-refresh setiap 30 detik:**
  â€¢ Status semua token aktif
  â€¢ Login attempts dan success rate
  â€¢ Unusual activity patterns
  â€¢ System performance metrics
  
  ğŸ“Š **Real-time metrics:**
  â€¢ Active tokens count
  â€¢ Average response time  
  â€¢ Success/failure ratios
  â€¢ Peak usage indicators
end note

Security -> Dashboard : **2. Update real-time statistics**
Dashboard -> Admin : **Tampilkan dashboard monitoring**
note right of Dashboard
  ğŸ–¥ï¸ **Admin IT Dashboard - Live Monitoring**
  
  â±ï¸ **Real-time Status (Auto-refresh: 30s)**
  
  ğŸ“ˆ **Today's Statistics:**
  â”œâ”€ Total tokens generated: 23
  â”œâ”€ Currently active: 3  
  â”œâ”€ Success rate: 95.7% (22/23)
  â”œâ”€ Average resolution time: 4.2 minutes
  â””â”€ Failed attempts: 1 (network timeout)
  
  ğŸ¯ **Active Tokens Right Now:**
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ ğŸŸ¢ john.doe      | Expires: 2m 15s      â”‚
  â”‚ ğŸŸ¡ mary.smith    | Expires: 12m 45s     â”‚  
  â”‚ ğŸŸ¢ bob.wilson    | Expires: 25m 10s     â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  
  âš ï¸ **Alerts:** 
  â€¢ john.doe token akan expired dalam 2 menit
  â€¢ Unusual activity: 3 failed logins dari IP 192.168.1.200
end note

== Sub-Fase 6B: Token Lifecycle Monitoring ==

Security -> DB : **3. Cek status semua token**\nSELECT * FROM tokens WHERE DATE(created_at) = CURDATE()

DB -> Security : **Token data hari ini**

Security -> Security : **4. Analisa token lifecycle**
note right of Security
  **Token Lifecycle Analysis:**
  
  ğŸŸï¸ **Generated Today:** 23 tokens
  
  **Status Breakdown:**
  â”œâ”€ âœ… Successfully used: 18 (78.3%)
  â”œâ”€ â° Expired unused: 3 (13.0%)
  â”œâ”€ ğŸ”„ Currently active: 3 (13.0%)
  â”œâ”€ âŒ Revoked by admin: 1 (4.3%)
  â””â”€ ğŸš« Failed validation: 0 (0%)
  
  **Timing Analysis:**
  â€¢ Average time to use: 3.5 minutes
  â€¢ Fastest usage: 45 seconds  
  â€¢ Longest valid duration: 28 minutes
  â€¢ Most common duration: 30 minutes (87%)
end note

Security -> Alerts : **5. Trigger alerts untuk anomali**

alt **Normal Usage Pattern**
    note right of Security
      âœ… **All Normal - No Alerts**
      
      â€¢ Usage dalam batas wajar (< 5 tokens/hour)
      â€¢ Success rate > 90%  
      â€¢ No security violations detected
      â€¢ Response times < 5 minutes average
    end note
    
else **Unusual Activity Detected**
    Alerts -> Admin : **6a. Send anomaly alert**
    note right of Alerts
      ğŸš¨ **Security Alert - Unusual Activity**
      
      **Detected Issues:**
      âš ï¸ High token generation rate:
         â€¢ 8 tokens dalam 30 menit terakhir
         â€¢ Normal average: 2-3 per hour
      
      âš ï¸ Multiple failed attempts:
         â€¢ IP 192.168.1.200: 5 failed validations
         â€¢ Possible brute force attempt
      
      âš ï¸ Token not used:
         â€¢ 3 tokens generated tapi tidak dipakai
         â€¢ Possible social engineering
      
      **Recommended Actions:**
      [Investigate] [Block IP] [Contact Users] [Review Logs]
    end note
    
    Admin -> Dashboard : **6b. Investigate alert**
    Dashboard -> Backend : GET /api/audit/suspicious-activity
    Backend -> DB : **Query suspicious patterns**
    
else **System Performance Issues**  
    Alerts -> Admin : **6c. Performance alert**
    note right of Alerts
      âš¡ **Performance Alert**
      
      **System Issues Detected:**
      â€¢ Response time > 10 seconds average
      â€¢ Database connection errors: 3 dalam 5 menit
      â€¢ High CPU usage: 85%
      â€¢ Memory usage: 92%
      
      **Auto-actions taken:**
      âœ… Scaled up backend servers
      âœ… Cleared unused connections  
      âœ… Restarted slow services
      
      [View Details] [Manual Override] [System Status]
    end note
end

== Sub-Fase 6C: Security Validation ==

Security -> Security : **7. Run security checks**
note right of Security
  **Automated Security Validations:**
  
  ğŸ” **Access Pattern Analysis:**
  â€¢ Cek login attempts dari IP tidak biasa
  â€¢ Validasi user behavior patterns  
  â€¢ Detect concurrent logins anomalies
  â€¢ Monitor token sharing indicators
  
  ğŸ›¡ï¸ **Threat Detection:**
  â€¢ Brute force attempt detection
  â€¢ Social engineering pattern recognition
  â€¢ Insider threat indicators
  â€¢ Compliance violation checks
end note

Security -> DB : **8. Audit log analysis**\nSELECT * FROM audit_logs WHERE created_at > DATE_SUB(NOW(), INTERVAL 1 HOUR)

alt **Suspicious Pattern Found**
    Security -> AuditLog : **9a. Log security incident**
    note right of AuditLog
      **Security Incident Logged:**
      
      ğŸ“ **Incident ID:** SEC-2024-1024-001
      ğŸ“… **Time:** 2024-10-24 14:25:00
      ğŸ¯ **Type:** Suspicious Token Usage
      
      **Details:**
      â€¢ User: Unknown (IP: 192.168.1.200)
      â€¢ Action: Multiple invalid token attempts  
      â€¢ Count: 7 attempts dalam 5 menit
      â€¢ Tokens tried: Mix of expired dan invalid
      â€¢ Risk Level: MEDIUM
      
      **Auto-actions:**
      âœ… IP temporarily blocked (15 minutes)
      âœ… Admin notifications sent
      âœ… Enhanced monitoring activated
    end note
    
    AuditLog -> Alerts : **Alert admin tentang incident**
    Alerts -> Admin : **Security incident notification**
    note right of Admin
      ğŸ“§ **Security Alert Email**
      ğŸ“± **WhatsApp Notification**  
      ğŸ”” **Dashboard Pop-up**
      
      "URGENT: Suspicious activity detected.
      Multiple invalid token attempts from 
      IP 192.168.1.200. Please investigate."
    end note
    
else **No Security Issues**
    Security -> AuditLog : **9b. Log normal operation**
    note right of AuditLog
      âœ… **Normal Operation Logged**
      
      â€¢ All security checks passed
      â€¢ No suspicious patterns detected  
      â€¢ System operating within normal parameters
      â€¢ Compliance requirements met
    end note
end

== Sub-Fase 6D: Compliance & Audit ==

Security -> Security : **10. Generate compliance reports**
note right of Security
  **Automated Compliance Checking:**
  
  ğŸ“‹ **Daily Compliance Report:**
  â€¢ Password policy adherence: âœ… 100%
  â€¢ Token expiry compliance: âœ… All within 2 hours max
  â€¢ Audit log completeness: âœ… All events logged
  â€¢ Data encryption status: âœ… All passwords encrypted
  
  ğŸ“Š **Regulatory Requirements:**
  â€¢ ISO 27001 controls: âœ… Met
  â€¢ GDPR data protection: âœ… Compliant  
  â€¢ Company IT policy: âœ… Followed
  â€¢ Access control matrix: âœ… Updated
end note

Security -> Backend : **11. Store compliance data**
Backend -> DB : **INSERT compliance report**
note right of Backend
  **Compliance Data Stored:**
  
  INSERT INTO compliance_reports:
  - report_id: COMP-2024-1024
  - report_date: 2024-10-24
  - total_tokens: 23
  - security_incidents: 1 (resolved)
  - policy_violations: 0
  - data_breaches: 0  
  - compliance_score: 98.5%
  - recommendations: ["Monitor IP 192.168.1.200"]
end note

== Sub-Fase 6E: Performance Analytics ==

Security -> Backend : **12. Analyze performance metrics**
Backend -> DB : **Query performance data**\nSELECT AVG(response_time), COUNT(*) FROM token_usage_logs WHERE DATE(created_at) = CURDATE()

DB -> Backend : **Performance statistics**
Backend -> Dashboard : **13. Update performance dashboard**
Dashboard -> Admin : **Show performance analytics**
note right of Dashboard
  ğŸ“Š **Performance Analytics Dashboard**
  
  âš¡ **System Performance Today:**
  â”œâ”€ Average response time: 2.3 seconds â¬‡ï¸ (-0.5s)
  â”œâ”€ Peak concurrent users: 12 ğŸ‘¥
  â”œâ”€ Database query time: 0.8s avg âš¡
  â”œâ”€ API success rate: 99.2% âœ…
  â””â”€ System uptime: 99.8% ğŸŸ¢
  
  ğŸ“ˆ **Trend Analysis (Last 7 Days):**
  â€¢ Token generation: +15% â¬†ï¸
  â€¢ Success rate: Stable ~95% â¡ï¸  
  â€¢ Response time: Improved -12% â¬‡ï¸
  â€¢ User satisfaction: 4.8/5 â­
  
  ğŸ¯ **Performance Targets:**
  â€¢ Response time: < 3s (âœ… ACHIEVED: 2.3s)
  â€¢ Success rate: > 90% (âœ… ACHIEVED: 95.7%)  
  â€¢ Uptime: > 99% (âœ… ACHIEVED: 99.8%)
  
  **Recommendations:**
  ğŸ’¡ Consider increasing token duration to 45 min
  ğŸ’¡ Add more detailed error messages
  ğŸ’¡ Implement SMS backup for token delivery
end note

== Sub-Fase 6F: User Experience Monitoring ==

Security -> Backend : **14. Collect user feedback data**
Backend -> DB : **Query user satisfaction**

alt **Positive User Feedback**
    DB -> Backend : **High satisfaction scores**
    Backend -> Dashboard : **15a. Show positive metrics**
    note right of Dashboard
      ğŸ˜Š **User Satisfaction - Excellent**
      
      ğŸ“Š **This Week's Feedback:**
      â­ Average rating: 4.8/5 (23 responses)
      
      **Positive Comments:**
      ğŸ’¬ "Sangat cepat, admin langsung respon!" - Finance Dept
      ğŸ’¬ "Sistemnya mudah dipake, ga ribet" - Marketing  
      ğŸ’¬ "Token langsung bisa dipake, thanks IT!" - HR
      
      **Top Appreciated Features:**
      âœ… Quick response time (87% mention)
      âœ… Easy-to-use interface (78% mention)
      âœ… Clear instructions (65% mention)
      
      **Suggestions for Improvement:**
      ğŸ’¡ "Kasih notif WhatsApp kalau token mau expired"
      ğŸ’¡ "Bisa extend token ga perlu generate baru?"
    end note
    
else **Mixed/Negative Feedback**
    DB -> Backend : **Lower satisfaction scores** 
    Backend -> Dashboard : **15b. Show concerning metrics**
    note right of Dashboard
      ğŸ˜ **User Satisfaction - Needs Attention**
      
      âš ï¸ **This Week's Issues:**
      ğŸ“‰ Average rating: 3.2/5 (18 responses)
      
      **Common Complaints:**
      âŒ "Token kedaluwarsa sebelum sempat dipake" (6x)
      âŒ "Susah copy paste token di HP" (4x)  
      âŒ "Admin lama respond pas urgent" (3x)
      âŒ "Password baru susah diingat" (2x)
      
      **Action Items Generated:**
      ğŸ”§ Extend default token duration 30â†’45 min
      ğŸ“± Improve mobile interface for token input
      âš¡ Set up auto-responder for after-hours  
      ğŸ¯ Add password complexity options
      
      [Address Issues] [Contact Users] [Update System]
    end note
end

== Sub-Fase 6G: Proactive System Maintenance ==

Security -> Security : **16. Schedule maintenance tasks**
note right of Security
  **Automated Maintenance (Daily 2 AM):**
  
  ğŸ§¹ **Database Cleanup:**
  â€¢ Delete expired tokens > 7 days old
  â€¢ Archive audit logs > 90 days old  
  â€¢ Compress old compliance reports
  â€¢ Update user activity statistics
  
  ğŸ”„ **System Health Checks:**
  â€¢ Validate all services running
  â€¢ Check disk space and memory
  â€¢ Test backup systems integrity  
  â€¢ Verify SSL certificates validity
  
  ğŸ“Š **Report Generation:**
  â€¢ Daily usage summary
  â€¢ Weekly trend analysis
  â€¢ Monthly compliance report
  â€¢ Quarterly security assessment
end note

Security -> Alerts : **17. Maintenance notifications**
alt **Maintenance Required**
    Alerts -> Admin : **18a. Maintenance alert**
    note right of Alerts
      ğŸ”§ **Scheduled Maintenance Alert**
      
      **Tomorrow 2:00 AM - 2:30 AM:**
      
      **Planned Activities:**
      âœ… Database optimization and cleanup
      âœ… Security patches application  
      âœ… Performance monitoring calibration
      âœ… Backup integrity verification
      
      **Expected Impact:**
      â€¢ System will be offline: 15-20 minutes
      â€¢ No token generation during maintenance
      â€¢ All data will be preserved
      
      **Preparation Needed:**
      ğŸ’¡ Notify users about maintenance window
      ğŸ’¡ Generate extra tokens before 1:45 AM
      ğŸ’¡ Have emergency contact ready
      
      [Approve] [Reschedule] [More Details]
    end note
    
else **System Healthy**
    Alerts -> Admin : **18b. All systems normal**  
    note right of Alerts
      âœ… **System Status: All Green**
      
      â€¢ No maintenance required
      â€¢ All systems operating optimally  
      â€¢ Performance within target ranges
      â€¢ Security posture excellent
      
      **Next Review:** Tomorrow 2:00 AM
    end note
end

== Continuous Improvement Loop ==

note over Admin, AuditLog
  **Continuous Improvement Process:**
  
  ğŸ”„ **Weekly Reviews:**
  â€¢ Analyze user feedback and pain points
  â€¢ Review security incidents and resolutions
  â€¢ Assess performance trends and bottlenecks
  â€¢ Update procedures based on learnings
  
  ğŸ“ˆ **Monthly Optimization:**
  â€¢ Fine-tune monitoring thresholds
  â€¢ Update security rules and patterns  
  â€¢ Optimize database queries and indexes
  â€¢ Enhance user experience based on feedback
  
  ğŸ¯ **Quarterly Strategic Reviews:**
  â€¢ Evaluate system architecture improvements
  â€¢ Plan new features and capabilities
  â€¢ Assess compliance with evolving regulations
  â€¢ Budget planning for system upgrades
  
  ğŸ’¡ **Innovation Pipeline:**
  â€¢ AI-powered anomaly detection
  â€¢ Biometric authentication integration
  â€¢ Mobile app development
  â€¢ Advanced analytics and reporting
end note

@enduml